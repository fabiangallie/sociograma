<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sociograma</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .names-list, .selection-box {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 1em;
      padding: 1em;
      margin: 1em auto;
      background: #fff;
      border-radius: 10px;
      border: 1px solid #ccc;
      min-height: 100px;
      max-width: 700px;
    }
    .card {
      width: 100px;
      height: 100px;
      border-radius: 10px;
      background: #d6f5e3;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      font-size: 0.9em;
      cursor: grab;
      padding: 0.5em;
    }
    .card:hover {
      background: #c5eed7;
    }
    .icon {
      font-size: 2.5em;
    }
    #informe {
      margin-top: 2em;
      padding: 1em;
      background: #fff;
      border-radius: 10px;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      white-space: pre-wrap;
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2 id="pregunta"></h2>
    <div class="names-list" id="lista-nombres"></div>
    <div class="selection-box" id="seleccion">Arrastra aquÃ­ tus elecciones (mÃ¡x. 3)</div>
    <button onclick="siguiente()">Siguiente</button>
    <div id="informe" style="display:none;"></div>
  </div>

  <script>
    const lang = localStorage.getItem('lang') || 'es';
    const preguntas = {
      es: [
        "Â¿Con quiÃ©n te gusta jugar en el recreo?",
        "Â¿Con quiÃ©n no te gusta jugar en el recreo?",
        "Â¿Con quiÃ©n te gusta trabajar en clase?",
        "Â¿Con quiÃ©n no te gusta trabajar en clase?"
      ],
      gl: [
        "Con quen che gusta xogar no recreo?",
        "Con quen non che gusta xogar no recreo?",
        "Con quen che gusta traballar na clase?",
        "Con quen non che gusta traballar na clase?"
      ]
    }[lang];

    const grupoKey = `grupo_${localStorage.getItem("alumno_curso")}_${localStorage.getItem("alumno_fecha")}`;
    const nombres = JSON.parse(localStorage.getItem(grupoKey)) || [];

    let paso = 0;
    const respuestas = [];

    const preguntaEl = document.getElementById("pregunta");
    const lista = document.getElementById("lista-nombres");
    const seleccion = document.getElementById("seleccion");
    const informe = document.getElementById("informe");

    function mezclarArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    function cargarPregunta() {
      preguntaEl.textContent = preguntas[paso];
      lista.innerHTML = "";
      seleccion.innerHTML = lang === "gl"
        ? "Arrastra aquÃ­ as tÃºas elecciÃ³ns (mÃ¡x. 3)"
        : "Arrastra aquÃ­ tus elecciones (mÃ¡x. 3)";
      const aleatorios = mezclarArray([...nombres]);

      aleatorios.forEach(nombre => {
        if (nombre === localStorage.getItem("alumno_nombre")) return;
        const card = document.createElement("div");
        card.className = "card";
        card.setAttribute("draggable", true);
        card.ondragstart = e => e.dataTransfer.setData("text", nombre);
        card.innerHTML = `<div class="icon">ðŸ‘¤</div><div>${nombre}</div>`;
        lista.appendChild(card);
      });
    }

    seleccion.ondragover = e => e.preventDefault();
    seleccion.ondrop = e => {
      e.preventDefault();
      const nombre = e.dataTransfer.getData("text");
      const yaEsta = [...seleccion.querySelectorAll(".card")].some(c => c.innerText.includes(nombre));
      if (!yaEsta && seleccion.querySelectorAll(".card").length < 3) {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `<div class="icon">ðŸ‘¤</div><div>${nombre}</div>`;
        seleccion.appendChild(card);
      }
    };

    function siguiente() {
      const elegidos = [...seleccion.querySelectorAll(".card")].map(c => c.innerText.trim());
      respuestas.push({ pregunta: preguntas[paso], seleccionados: elegidos });
      paso++;
      if (paso < preguntas.length) {
        cargarPregunta();
      } else {
        mostrarInforme();
      }
    }

    function mostrarInforme() {
      document.querySelector("h2").textContent = lang === "gl" ? "Informe final" : "Informe final";
      lista.style.display = "none";
      seleccion.style.display = "none";
      document.querySelector("button").style.display = "none";

      const nombre = localStorage.getItem("alumno_nombre") || "DescoÃ±ecido";
      const curso = localStorage.getItem("alumno_curso") || "Sen curso";
      const fecha = localStorage.getItem("alumno_fecha") || "Sen data";

      let texto = `${lang === "gl" ? "Nome do alumno/a" : "Alumno/a"}: ${nombre}\nCurso: ${curso}\nData: ${fecha}\n\n${lang === "gl" ? "Respostas" : "Respuestas"}:\n`;
      respuestas.forEach(r => {
        texto += `\n${r.pregunta}\nâ†’ ${r.seleccionados.join(", ") || (lang === "gl" ? "NinguÃ©n" : "Ninguno")}\n`;
      });

      informe.innerText = texto;
      informe.style.display = "block";
    }

    cargarPregunta();
  </script>
</body>
</html>
